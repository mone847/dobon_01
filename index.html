<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
  <title>カードゲーム「DOBON」Ver.0.5</title>

  <!-- PyScript（固定版） -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2026.2.1/core.css">
  <script type="module" src="https://pyscript.net/releases/2026.2.1/core.js"></script>

  <!-- cards.js -->
  <script defer src="cards.js"></script>

  <style>
    body { font-family: sans-serif; margin: 0; padding: 18px; background: #fff; }
    h1 { margin: 0 0 10px 0; font-size: 22px; }

    .layout {
      display: grid;
      grid-template-columns: 520px 320px 320px;
      gap: 18px;
      align-items: start;
    }

    /* 左：プレーヤー（CPU3人）の箱 */
    .cpu-box {
      border: 1px solid #999;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 12px;
    }
    .cpu-title { font-weight: 800; margin-bottom: 10px; }
    .mini-row { display: flex; gap: 10px; flex-wrap: wrap; }
    .mini-row img { width: 52px; height: auto; }

    /* 中央：場札 */
    .center { text-align: center; }
    .label { font-size: 22px; font-weight: 900; margin-bottom: 10px; }

    .field-frame {
      width: 280px;
      height: 360px;
      margin: 0 auto;
      border-radius: 26px;
      background: #2f5f78;
      padding: 14px;
      box-sizing: border-box;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 4px 10px rgba(0,0,0,.15);
    }
    .field-frame img { width: 240px; height: auto; border-radius: 14px; background:#fff; }

    /* 右：山札 */
    .right { text-align:center; }
    .deck-wrap { margin-top: 6px; display:flex; justify-content:center; }
    .deck-card {
      width: 240px; height: auto; cursor: pointer;
      border-radius: 14px;
      box-shadow: 0 4px 10px rgba(0,0,0,.15);
      transition: transform .12s ease;
      user-select: none;
    }
    .deck-card:hover { transform: translateY(-6px); }
    .deck-card.disabled { opacity: .45; cursor: not-allowed; transform: none !important; }

    /* 下：あなたの手札 */
.hand-frame{
  border: 1px solid #999;
  border-radius: 10px;
  padding: 38px;
  position: relative;          /* ★重ね表示の土台 */
  min-height: 240px;           /* ★カードを重ねても高さ確保 */
  overflow: auto;              /* ★はみ出たらスクロール（リミッター） */
  overflow-y:hidden;
  touch-action: pan-x;
  -webkit-overflow-scrolling: touch;
  background: #fff;
}

/* 手札カード（通常でも重ねでも共通） */
.hand-card{
  width: 140px;
  height: auto;
  border-radius: 14px;
  cursor: pointer;
  user-select: none;
  transition: transform .12s ease, box-shadow .12s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,.12);
  background: #fff;
}

/* ★重ね表示モードのときは absolute で配置する（Python側で設定） */
.hand-card.stack{
  position: absolute;
  box-shadow: none;
}

/* ★ホバーで“少し持ち上がる”＋最前面に */
.hand-card:hover{
  transform: translateY(-22px);
  box-shadow: 0 12px 18px rgba(0,0,0,.18);
  z-index: 999 !important;
}

/* 出せないカードの見た目（今回は「取る」優先なので残すだけ） */
.hand-card.disabled{
  opacity: 1;
  outline: 3px solid rgba(0,0,0,.12);
}

/* 山札：ホバー＋クリック */
.deck-card{
  width: 240px; height: auto; cursor: pointer;
  border-radius: 14px;
  box-shadow: 0 4px 10px rgba(0,0,0,.15);
  transition: transform .12s ease;
  user-select: none;
}
.deck-card:hover{ transform: translateY(-6px); }
.deck-card.disabled{ opacity:.45; cursor:not-allowed; transform:none !important; }


    /* メッセージ */
    #msg {
      margin-top: 10px;
      font-size: 16px;
      white-space: pre-line;
    }
    .ok { color: #156c2f; font-weight: 800; }
    .ng { color: #b00020; font-weight: 800; }

    .toolbar { margin-top: 10px; display:flex; gap: 10px; flex-wrap: wrap; }
    button { font-size: 16px; padding: 8px 14px; }

    @media (max-width: 1180px) {
      .layout { grid-template-columns: 1fr; }
      .field-frame { width: 260px; height: 330px; }
      .field-frame img { width: 220px; }
      .deck-card { width: 200px; }
      .hand-card { width: 120px; }
    }


/* ===== iPad横向き専用レイアウト ===== */
@media (hover: none) and (pointer: coarse) and (orientation: landscape) {

  /* ===== 全体レイアウト ===== */
  .layout{
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-areas:
      "left   left"      /* 上段：CPU3人 */
      "center right";    /* 中段：場 と 山 */
    gap: 14px;
  }

  /* layout内の3ブロック割当 */
  .layout > div:nth-child(1){ grid-area: left; }
  .layout > div:nth-child(2){ grid-area: center; }
  .layout > div:nth-child(3){ grid-area: right; }

  /* ===== CPUエリア：横並び3列 ===== */
  .layout > div:nth-child(1){
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
  }

  .cpu-box{
    padding: 10px;
    margin-bottom: 0;
  }

  .cpu-title{
    font-size: 16px;
    margin-bottom: 6px;
    white-space: nowrap;
    text-align: center;
  }

  /* 裏カード1枚だけ大きめ表示 */
  .mini-row{
    justify-content: center;
  }

  .mini-row img{
    width: 68px;
  }

  /* ===== 場札 ===== */
  .field-frame{
    width: 220px;
    height: 300px;
  }

  .field-frame img{
    width: 180px;
  }

  /* ===== 山札 ===== */
  .deck-card{
    width: 160px;
  }

  /* ===== 手札（最下段） ===== */
  .hand-frame{
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-x;
  }

  /* iPadではhoverを無効化 */
  .hand-card:hover{
    transform: none;
    box-shadow: 0 2px 6px rgba(0,0,0,.12);
  }

  /* タップ選択時だけ浮かす */
  .hand-card.selected{
    transform: translateY(-22px);
    outline: 4px solid rgba(0,120,255,.35);
    z-index: 999 !important;
  }

  /* 重ね表示時は影を消す（見やすさ向上） */
  .hand-card.stack{
    box-shadow: none;
  }

  /* disabledは透明にしない（重なりで濁るのを防ぐ） */
  .hand-card.disabled{
    opacity: 1;
    outline: 3px solid rgba(0,0,0,.12);
  }
}


/* ====== マウス環境だけ hover を効かせる ====== */
@media (hover: hover) and (pointer: fine) {
  .hand-card:hover{
    transform: translateY(-22px);
    box-shadow: 0 12px 18px rgba(0,0,0,.18);
    z-index: 999 !important;
  }
}
  
  </style>
</head>

<body>
  <h1>DOBON（Ver.0.5：配布＋場札＋あなたが出す）</h1>

  <div class="layout">
    <!-- 左：CPU -->
    <div>
      <div class="cpu-box">
        <div class="cpu-title" id="cpuA-title">プレーヤーA（0枚）</div>
        <div class="mini-row" id="cpuA-cards"></div>
      </div>
      <div class="cpu-box">
        <div class="cpu-title" id="cpuB-title">プレーヤーB（0枚）</div>
        <div class="mini-row" id="cpuB-cards"></div>
      </div>
      <div class="cpu-box">
        <div class="cpu-title" id="cpuC-title">プレーヤーC（0枚）</div>
        <div class="mini-row" id="cpuC-cards"></div>
      </div>
    </div>

    <!-- 中央：場 -->
    <div class="center">
      <div class="label">場のカード</div>
      <div class="field-frame">
        <img id="field-card" src="" alt="field">
      </div>
    </div>

    <!-- 右：山 -->
    <div class="right">
      <div class="label" id="deck-title">山のカード（0枚）</div>
      <div class="deck-wrap">
        <img id="deck-card" class="deck-card" src="" alt="deck">
      </div>

      <div class="toolbar">
        <button py-click="reset_game">配り直し</button>
        <button id="dobon-btn" py-click="try_dobon">ドボン！</button>
      </div>
      <div id="msg"></div>
    </div>
  </div>

  <!-- 下：あなた -->
  <div class="hand-area">
    <div class="hand-title">あなたのカード</div>
    <div id="your-hand" class="hand-frame"></div>
  </div>

  <script type="py" src="main.py"></script>
</body>
</html>
